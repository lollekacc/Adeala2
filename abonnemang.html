<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Adeala – Abonnemang</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
</head>

<body class="min-h-screen font-[Inter] bg-white text-gray-900">

  <!-- HEADER -->
  <div id="header-placeholder"></div>

  <!-- HERO -->
  <section class="relative w-full h-[380px] overflow-hidden">
    <img src="https://png.pngtree.com/thumb_back/fw800/background/20250902/pngtree-abstract-mobile-phone-background-image_18720985.webp"
         class="w-full h-full object-cover opacity-80">
    <div class="absolute inset-0 bg-gradient-to-b from-[#004C9E]/50 to-[#0C4A3C]/70"></div>

    <div class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 text-center">
      <h1 class="text-4xl font-extrabold text-white drop-shadow-lg">Välj rätt abonnemang</h1>
      <p class="mt-4 text-white/90 text-lg max-w-xl mx-auto">
        Utforska de bästa alternativen för dig eller din familj.
      </p>
    </div>
  </section>

  <!-- OFFERS SECTION -->
  <section id="offersSection" class="hidden mt-20 px-10 pb-20">
    <h2 class="text-center text-4xl font-bold text-[#0C4A3C] mb-14">
      Aktuella erbjudanden
    </h2>

    <div class="max-w-[1800px] mx-auto">
      <div id="offers-container"
           class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-10"></div>
    </div>
  </section>

  <!-- =======================
       PCHOICE MODAL
  ======================= -->
  <div id="pchoiceOverlay"
       class="fixed inset-0 bg-black/60 hidden z-[9999] flex items-center justify-center">

    <div id="pchoiceModal"
         class="relative bg-white w-full max-w-5xl h-[90vh] rounded-2xl shadow-2xl overflow-hidden">

      <div class="flex items-center justify-between px-6 py-4 border-b bg-white">
        <h3 class="text-lg font-bold text-[#0C4A3C]">Välj dina belöningar</h3>

        <div class="flex gap-2">
          <button id="minimizePchoice"
                  class="px-3 py-1 rounded-lg bg-gray-100 hover:bg-gray-200">—</button>
          <button id="closePchoice"
                  class="px-3 py-1 rounded-lg bg-red-100 hover:bg-red-200">✕</button>
        </div>
      </div>

      <iframe id="pchoiceFrame"
              class="w-full h-full border-0"
              loading="lazy"></iframe>
    </div>
  </div>

<script type="module">

/* ======================
   MODAL HELPERS
====================== */
function openPchoice() {
  const overlay = document.getElementById("pchoiceOverlay");
  const frame = document.getElementById("pchoiceFrame");
  frame.src = "pchoice.html";
  overlay.classList.remove("hidden");
}

function closePchoice() {
  const overlay = document.getElementById("pchoiceOverlay");
  const frame = document.getElementById("pchoiceFrame");
  overlay.classList.add("hidden");
  frame.src = "";
}

/* ======================
   DOM READY
====================== */
document.addEventListener("DOMContentLoaded", async () => {
  document.getElementById("header-placeholder").innerHTML =
    await fetch("partials/header.html").then(r => r.text());

  document.body.insertAdjacentHTML("beforeend",
    await fetch("partials/chat.html").then(r => r.text()));

  document.body.insertAdjacentHTML("beforeend",
    await fetch("partials/footer.html").then(r => r.text()));

  document.getElementById("closePchoice").onclick = closePchoice;
  document.getElementById("minimizePchoice").onclick = () => {
    const modal = document.getElementById("pchoiceModal");
    modal.classList.toggle("h-[90vh]");
    modal.classList.toggle("h-[64px]");
  };
});

/* ======================
   OFFER RENDER
====================== */
const offersContainer = document.getElementById("offers-container");

function renderOffers(offers) {
  offersContainer.innerHTML = "";

  offers.slice(0, 3).forEach(o => {
    const reward = calculateReward(o.finalPrice);

    const card = document.createElement("button");
    card.className =
      "relative offer-choice text-left border rounded-2xl shadow bg-white p-6 flex flex-col justify-between cursor-pointer";

    card.innerHTML = `
      <button class="reward-circle gift-btn"
              data-reward="${reward}"
              data-offer-id="${o.id}"
              type="button">${reward}:-</button>

      <div>
        <img src="${o.logo}" class="h-16 mx-auto mb-4 object-contain">
        <h3 class="text-xl font-semibold text-[#0C4A3C]">${o.title}</h3>
        <p class="font-semibold text-lg">${o.finalPrice} kr/mån</p>
      </div>
    `;

    const rewardBtn = card.querySelector(".gift-btn");
    rewardBtn.addEventListener("click", e => {
      e.stopPropagation();
      localStorage.setItem("rewardChoice", JSON.stringify({
        reward,
        offerId: o.id || ""
      }));
      openPchoice();
    });

    offersContainer.appendChild(card);
  });
}

/* ======================
   REWARD LOGIC
====================== */
function calculateReward(price) {
  if (price < 299) return 200;
  if (price < 399) return 400;
  if (price < 499) return 600;
  if (price < 699) return 800;
  return 1000;
}

</script>

</body>
</html>
